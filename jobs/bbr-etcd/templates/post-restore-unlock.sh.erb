#!/bin/bash -eu

source /var/vcap/packages/tools/scripts/common.sh
source /var/vcap/jobs/etcd/bin/etcd-functions.sh
assert_declared_functions 'etcd_remove_restoring_flag_file'

etcd_store_dir=''
source /var/vcap/jobs/bbr-etcd/bin/bbr/bbr-utils.sh
assert_declared_functions 'log_audit' 'etcd_job_start'
assert_non_empty_variables 'etcd_store_dir'

log_audit "begin"

if etcd_job_start; then
  etcd_remove_restoring_flag_file "$etcd_store_dir"
  log_audit "success: etcd is started"
else
  log_audit "failure: etcd is NOT started"
  exit 1
fi

